#!/bin/sh

export TARGET_OUTPUT="target"

while [[ $# -gt 0 ]]
do
key="$1"

case $key in
    -d|--docker)
    echo "DOCKER SELECTION"
    export RUN_WITH="DOCKER"
    shift # past argument
    ;;
    --default)
    echo "DEFAULT SELECTION"
    export RUN_WITH="DEFAULT"
    ;;
    *)
    # unknown option
    ;;
esac
shift # past argument or value
done

if [ ! -d "$TARGET_OUTPUT" ]; then
    echo "Control will enter here if $TARGET_OUTPUT doesn't exist. Therefore build operation going to start."
    mvn clean install -o -DskipTests
fi


if [ "DOCKER" == "$RUN_WITH" ]; then
    echo "docker"
    //remove container
    docker rm -f {{artifactId}}

    //remove images
    docker rmi vertx-sample-{{artifactId}}

    docker build -t vertx-sample-{{artifactId}} .

    docker run  --name {{artifactId}} -t -i -p 8080:8080 vertx-sample-{{artifactId}}
else
    echo "default"
    java -jar target/{{artifactId}}-{{artifactVersion}}-fat.jar -conf config.json
fi